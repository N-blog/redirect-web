<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script>
    window.onload = function () {
      const jsonUrl = "https://raw.githubusercontent.com/N-blog/apis/refs/heads/main/redirect-web/main.json";

      fetch(jsonUrl)
        .then(response => response.text())
        .then(text => {
          if (!text.trim()) {
            throw new Error("JSONが空です！");
          }

          const data = JSON.parse(text);

          // IDとUrlのチェック（IDは # で始まるものだけ許可）
          if (!data.ID || !data.Url || !/^#\w+/.test(data.ID)) {
            console.error("IDが不正です。形式は #xxxx のみ許可されます。");
            document.body.innerHTML = "<p style='color:red;'>リダイレクトエラー：IDが不正です。</p>";
            return;
          }

          // リダイレクト先のURLを構築
          let redirectUrl = data.Url.replace(/\/+$/, ""); // 末尾のスラッシュを削除
          redirectUrl += "/" + data.ID; // 例: https://username.github.io/project/#aaaa

          console.log("リダイレクト先:", redirectUrl);

          // 2秒後にリダイレクト
          setTimeout(() => {
            window.location.href = redirectUrl;
          }, 2000);
        })
        .catch(error => {
          console.error("JSONの取得に失敗しました:", error.message);
          document.body.innerHTML = "<p style='color:red;'>JSONの取得に失敗しました。</p>";
        });
    };
  </script>
</head>
<body>
  <p>リダイレクト中です。少々お待ちください…</p>
</body>
</html>
