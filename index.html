<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script>
    window.onload = function () {
      const jsonUrl = "https://raw.githubusercontent.com/N-blog/apis/refs/heads/main/redirect-web/main.json";

      fetch(jsonUrl)
        .then(response => response.text())
        .then(text => {
          if (!text.trim()) {
            throw new Error("JSONが空です！");
          }

          const data = JSON.parse(text);

          // IDを優先、ID2は使わない（またはURLパラメータで切り替え）
          const urlParams = new URLSearchParams(window.location.search);
          const useID2 = urlParams.get("useID2") === "true";
          const id = useID2 ? data.ID2 : data.ID;

          if (!id || !data.Url) {
            console.error("IDとUrlは必須です");
            return;
          }

          // リダイレクト先のURLを構築
          let redirectUrl = data.Url;

          if (redirectUrl.endsWith("/")) {
            redirectUrl = redirectUrl.slice(0, -1);
          }

          if (id.startsWith("#")) {
            redirectUrl += "/" + id;
          } else if (id.startsWith("?")) {
            redirectUrl += "/" + id;
          } else if (id.startsWith("type=")) {
            redirectUrl += "/?" + id;
          } else {
            redirectUrl += "/#" + id;
          }

          console.log("リダイレクト先:", redirectUrl);

          // 2秒後にリダイレクト
          setTimeout(() => {
            window.location.href = redirectUrl;
          }, 2000);
        })
        .catch(error => {
          console.error("JSONの取得に失敗しました:", error.message);
        });
    };
  </script>
</head>
<body>
  <p>リダイレクト中です。少々お待ちください…</p>
</body>
</html>
