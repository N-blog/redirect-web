<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script>
    window.onload = function () {
      const jsonUrl = "https://n-blog.github.io/redirect-web/main.json";

      // クエリ or ハッシュからIDを取得
      const urlParams = new URLSearchParams(window.location.search);
      const queryID = urlParams.get("id");
      const hashID = window.location.hash.replace(/^#/, "");
      const targetID = queryID || hashID;

      if (!targetID) {
        document.body.innerHTML = "<p style='color:red;'>URLに ?id=xxx または #xxx を指定してください。</p>";
        return;
      }

      fetch(jsonUrl + "?v=" + Date.now()) // キャッシュ回避
        .then(response => response.text())
        .then(text => {
          if (!text.trim()) {
            throw new Error("JSONが空です！");
          }

          const entries = JSON.parse(text);

          if (!Array.isArray(entries)) {
            throw new Error("JSONは配列形式である必要があります。");
          }

          const entry = entries.find(item => item.ID === targetID);

          if (!entry || !entry.Url) {
            document.body.innerHTML = `<p style='color:red;'>指定されたID「${targetID}」が見つかりません。</p>`;
            return;
          }

          let redirectUrl = entry.Url.replace(/\/+$/, "");
          redirectUrl += "/#" + entry.ID;

          console.log("リダイレクト先:", redirectUrl);

          setTimeout(() => {
            window.location.href = redirectUrl;
          }, 2000);
        })
        .catch(error => {
          console.error("エラー:", error.message);
          document.body.innerHTML = "<p style='color:red;'>JSONの取得に失敗しました。</p>";
        });
    };
  </script>
</head>
<body>
  <p>リダイレクト中です。少々お待ちください…</p>

</body>
    <p>v1.0 </p>
</html>
